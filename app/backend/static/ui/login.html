<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Login</title>
  <style>
    :root { --bg:#0b1220; --card:#121a2f; --text:#e6eaf2; --muted:#9aa3b2; --accent:#4d7cff; --danger:#ff5c5c; }
    * { box-sizing: border-box }
    body { margin:0; min-height:100svh; display:grid; place-items:center; background:linear-gradient(180deg,#0a0f1e,#0e1324); }
    .card { background:var(--card); color:var(--text); width:min(420px,92vw); border-radius:16px; padding:24px; box-shadow:0 10px 25px rgba(0,0,0,.4); }
    h1 { margin:0 0 16px; font:600 20px system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji"; }
    label { display:block; font-size:14px; color:var(--muted); margin-bottom:6px; }
    input { width:100%; padding:12px 14px; border-radius:10px; border:1px solid #28324a; background:#0d1426; color:var(--text); outline:none; }
    input:focus { border-color:var(--accent); box-shadow:0 0 0 3px rgba(77,124,255,.2); }
    .row { margin-bottom:14px; }
    button { width:100%; padding:12px 16px; border-radius:12px; border:0; background:var(--accent); color:white; font-weight:600; cursor:pointer; }
    button[disabled] { opacity:.6; cursor:not-allowed; }
    .note { margin-top:12px; font-size:12px; color:var(--muted); }
    #status { margin-top:12px; padding:10px 12px; border-radius:10px; display:none; }
    #status.ok { display:block; background:rgba(77,124,255,.12); border:1px solid rgba(77,124,255,.4); }
    #status.err { display:block; background:rgba(255,92,92,.12); border:1px solid rgba(255,92,92,.4); }
  </style>
</head>
<body>
  <main class="card">
    <h1>Sign in</h1>
    <form id="loginForm" autocomplete="on" spellcheck="false">
      <div class="row">
        <label for="username">Username</label>
        <input id="username" name="username" type="text" required autocomplete="username" autocapitalize="none" />
      </div>
      <div class="row">
        <label for="password">Password</label>
        <input id="password" name="password" type="password" required autocomplete="current-password" />
      </div>
      <button id="loginBtn" type="submit">Login</button>
      <div class="note">Weâ€™ll send a JSON POST to <code>/login</code>.</div>
      <div id="status" role="status" aria-live="polite"></div>
    </form>
    <noscript><p class="note">JavaScript is required to submit as JSON.</p></noscript>
  </main>

  <script>
    (function () {
      const form = document.getElementById('loginForm');
      const btn = document.getElementById('loginBtn');
      const statusEl = document.getElementById('status');

      function showStatus(kind, msg) {
        statusEl.className = '';
        statusEl.classList.add(kind === 'ok' ? 'ok' : 'err');
        statusEl.textContent = msg;
      }

      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        const username = form.username.value.trim();
        const password = form.password.value;

        if (!username || !password) {
          showStatus('err', 'Please enter both username and password.');
          return;
        }

        btn.disabled = true;
        showStatus('ok', 'Signing in...');
        try {
          const res = await fetch('/login', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Accept': 'application/json'
            },
            credentials: 'include', // send/receive cookies if your server uses them
            body: JSON.stringify({ username, password })
          });

          const contentType = res.headers.get('content-type') || '';
          let payload;
          if (contentType.includes('application/json')) {
            payload = await res.json();
          } else {
            payload = await res.text();
          }

          if (res.ok) {
            showStatus('ok', typeof payload === 'string' ? payload : (payload.message || 'Login successful.'));
          } else {
            showStatus('err', typeof payload === 'string' ? payload : (payload.error || 'Login failed.'));
          }
        } catch (err) {
          showStatus('err', 'Network error. Please try again.');
          console.error(err);
        } finally {
          btn.disabled = false;
        }
      });
    })();
  </script>
</body>
</html>
